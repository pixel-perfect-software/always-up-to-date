// filepath: /always-up-to-date/always-up-to-date/tests/services/vulnerability-scanner.test.ts
import { scanForVulnerabilities } from "../../src/services/vulnerability-scanner";

describe("Vulnerability Scanner Service", () => {
  test("should detect known vulnerabilities in dependencies", async () => {
    const mockDependencies = {
      "express": "4.17.1",
      "lodash": "4.17.20",
    };

    const vulnerabilities = await scanForVulnerabilities(mockDependencies);
    
    expect(vulnerabilities).toEqual(
      expect.arrayContaining([
        expect.objectContaining({
          package: "express",
          version: "4.17.1",
          vulnerability: expect.any(String),
        }),
      ])
    );
  });

  test("should return an empty array if no vulnerabilities are found", async () => {
    const mockDependencies = {
      "some-safe-package": "1.0.0",
    };

    const vulnerabilities = await scanForVulnerabilities(mockDependencies);
    
    expect(vulnerabilities).toEqual([]);
  });

  test("should handle errors gracefully", async () => {
    const mockDependencies = null;

    await expect(scanForVulnerabilities(mockDependencies)).rejects.toThrow("Invalid dependencies");
  });
});